#!/bin/sh

TABLE_DOWN_RULE_01(){
  local rs
  rs='1'
  local cmd=$(iptables-save | grep -- "-A POSTROUTING -o eth0 -j MASQUERADE" | awk '{ if ( $0 ){ print "1" } }')
  if [ ! -z "$cmd" ]; then
    su -s /bin/sh -c "/sbin/iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE" root
    if [ "$?" -ne 0 ]; then
      rs='1'
    else
      rs='0'
    fi
  fi
  echo $rs
}

TABLE_DOWN_RULE_02(){
  local rs
  rs='1'
  local cmd=$(iptables-save | grep -- "-A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT" | awk '{ if ( $0 ){ print "1" } }')
  if [ ! -z "$cmd" ]; then
    su -s /bin/sh -c "/sbin/iptables -D FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT" root
    if [ "$?" -ne 0 ]; then
      rs='1'
    else
      rs='0'
    fi
  fi
  echo $rs
}

TABLE_DOWN_RULE_03(){
  local rs
  rs='1'
  local cmd=$(iptables-save | grep -- "-A FORWARD -i wlan0 -o eth0 -j ACCEPT" | awk '{ if ( $0 ){ print "1" } }')
  if [ ! -z "$cmd" ]; then
    su -s /bin/sh -c "/sbin/iptables -D FORWARD -i wlan0 -o eth0 -j ACCEPT" root
    if [ "$?" -ne 0 ]; then
      rs='1'
    else
      rs='0'
    fi
  fi
  echo $rs
}

echo $(TABLE_DOWN_RULE_01)
echo $(TABLE_DOWN_RULE_02)
echo $(TABLE_DOWN_RULE_03)

exit 0

#!/bin/sh

TABLE_UP_RULE_01(){
  local rs
  rs='1'
  local cmd=$(iptables-save | grep -- "-A POSTROUTING -o eth0 -j MASQUERADE" | awk '{ if ( $0 ){ print "1" } }')
  if [ ! -z "$cmd" ]; then
     rs='1'
  else
     su -s /bin/sh -c "/sbin/iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE" root
     if [ "$?" -ne 0 ]; then
       rs='1'
     else
       rs='0'
     fi
  fi
  echo $rs
}

TABLE_UP_RULE_02(){
  local rs
  rs='1'
  local cmd=$(iptables-save | grep -- "-A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT" | awk '{ if ( $0 ){ print "1" } }')
  if [ ! -z "$cmd" ]; then
     rs='1'
  else
     su -s /bin/sh -c "/sbin/iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT" root
     if [ "$?" -ne 0 ]; then
       rs='1'
     else
       rs='0'
     fi
  fi
  echo $rs
}

TABLE_UP_RULE_03(){
  local rs
  rs='1'
  local cmd=$(iptables-save | grep -- "-A FORWARD -i wlan0 -o eth0 -j ACCEPT" | awk '{ if ( $0 ){ print "1" } }')
  if [ ! -z "$cmd" ]; then
     rs='1'
  else
     su -s /bin/sh -c "/sbin/iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT" root
     if [ "$?" -ne 0 ]; then
       rs='1'
     else
       rs='0'
     fi
  fi
  echo $rs
}


echo $(TABLE_UP_RULE_01)
echo $(TABLE_UP_RULE_02)
echo $(TABLE_UP_RULE_03)

exit 0
